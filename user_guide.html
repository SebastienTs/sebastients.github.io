<!DOCTYPE html>
<html lang="en">
<head>
    <title>Getting started with LOBSTER</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">    
    <link rel="shortcut icon" href="favicon.ico">  
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <!-- FontAwesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>
    <!-- Global CSS -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">   
    <!-- Plugins CSS -->    
    <link rel="stylesheet" href="assets/plugins/prism/prism.css">
    <link rel="stylesheet" href="assets/plugins/elegant_font/css/style.css">  
    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="assets/css/styles.css"> 
</head> 

<body class="body-pink">
    <div class="page-wrapper">
        <!-- ******Header****** -->
        <header id="header" class="header">
            <div class="container">
                <div class="branding">
                    <h1 class="logo">
                        <a href="index.html">
                            <span aria-hidden="true" class="icon_documents_alt icon"></span>
                            <span class="text-highlight">LOB</span><span class="text-bold">STER</span>
                        </a>
                    </h1>    
                </div>
            </div>
        </header>
		
        <div class="doc-wrapper">
            <div class="container">
                <div id="doc-header" class="doc-header text-center">
                    <h1 class="doc-title"><i class="icon fa fa-book"></i> Getting Started</h1>
                    <div class="meta"><i class="far fa-clock"></i> Last updated: November 13th, 2019</div>
                </div>
				
				<!--//doc-header-->
                <div class="doc-body row">
                    
                    <div class="doc-content col-md-9 col-12 order-1">

						<section id="intro-section" class="doc-section">
                    	<p><b>LOBSTER</b> is an image analysis environment to identify biological objects in multidimensional microscopy images and measure their spatial location, geometry, dynamics and intensity distribution. 3D objects can be exported as models importable in external software (visualization, edition, simulation...). All images are processed by automatic workflows (no interaction), no limit is set on their size, and any number of images can be batch processed in one go.</p>
						</section>

                        <div class="content-inner">
                            <section id="setup-section" class="doc-section">
                                <h2 class="section-title">Setting Up</h2>
                                <div class="section-block">
                                  <p>Assuming that <b>MATLAB</b> (version >=2015a) and both <b>Image processing</b> and <b>Statistics & Machine Learning</b> toolboxes are installed, setting up the software is extremely simple and summarized below:</p>
								  <ul>
                                   <li>Download the software from the <a href="https://github.com/SebastienTs/LOBSTER" target="_blank"> GitHub repository</a> (Clone or download green button)</li>
                                   <li>Unzip the content to an empty folder where MATLAB has read/write access</li> 
                                   <li>Create an empty folder <b>/Images</b> inside installation folder and unzip the content of <a href="https://drive.google.com/file/d/18A0sm-69TTEl-19DAprqiLHmO-0nBkg4/view?usp=sharing" target="_blank">this archive</a> inside</li>
                                   <li>Create an empty folder <b>/Results</b> inside installation folder, and unzip the content of <a href="https://drive.google.com/file/d/1GiJd-JfBvOHJcm_WOB1_gAvMuRAZzOy3/view?usp=sharing" target="_blank">this archive</a> inside</li>
                                   </ul>
                                   Windows is highly recommended but <b>LOBSTER</b> should be compatible with all major operating systems. Refer to <a href="https://drive.google.com/file/d/1hn9RIoW2sG8nhYN_fLvrPlskLbM0sao7/view?usp=sharing" target="_blank"> documentation</a> for details (sections <b>Requirements, Installation and Startup</b>).
                                  </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->

                        <div class="content-inner">
                            <section id="init-section" class="doc-section">
                                <h2 class="section-title">Initializing</h2>
                                <div class="section-block">
                                   <p>To initialize <b>LOBSTER</b>: 
                                   <ul>	
                                   <li>Launch MATLAB</li>
                                   <li>>> <b>cd E:/LOBSTER</b> (substitute by the path to <b>LOBSTER</b> folder)</li>
                                   <li>>> <b>init</b></li>
                                   </ul>
                                   This action <b>must be performed once before using any LOBSTER component </b> and it is illustrated at the beginning of <a href="https://drive.google.com/file/d/1N9KWKvS52NMGZH0WiYF8bwJLZsvLFx6J/view?usp=sharing" target="_blank">this video</a>.  
                                  </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->

                        <div class="content-inner">
                            <section id="architecture-section" class="doc-section">
	                              <h2 class="section-title">Architecture</h2>
	                              <div class="section-block">
	                              <p>
	                              <b>LOBSTER</b> relies on objects masks as building blocks and it decouples objects identification, measurements and visualization. These operations are respectively performed by three computational modules called either from MATLAB console (scripting) or triggered from <b>LOBSTER</b> Panel (Graphical User Interface). In this tutorial we will cover the second option, refer to <a href="scripting.html" target="_blank">this page</a> for details on scripting.
				    			  </p>
                                  <div class="screenshot-holder">
								    <img class="img-architecture" src="assets/images/architecture.png" alt="screenshot" width="640">
				    			  </div>
                                  <p>
                                  <b>JENI: Identifying objects</b></p>
                                  <p>TIFF images from an input folder are typically processed into object masks by applying a sequence of image analysis functions (workflow) configured in a journal (short text file) and processed by <b>JENI</b>. The object masks can be of 4 kinds:</p>
                                  <ul>
                                  	<li>Binary masks ('<b>Objs</b>'): plain objects encoded as connected groups of foreground pixels</li>
									<li>Skeleton masks ('<b>Skls</b>'): 1-pixel curves marking filament centrelines</li>
									<li>Seed masks ('<b>Spts</b>'): each foreground pixel mark an object</li>
									<li>Label masks ('<b>Trks</b>'): plain objects encoded as connected groups of pixels (unique <b>IDs</b>).</li>
								  </ul>
                                  </p>
								  
                                  <p><b>IRMA: Measuring object masks</b></p>
                                  <p>
								  
								  <div class="screenshot-holder">
								    <img class="img-objmask" src="assets/images/ObjectMask.png" alt="screenshot" width="480">
				    			  </div>
								  
								  <p>
								  Journals and object masks are the basic building blocks to more complex workflows. For instance, in the figure above <b>Object Mask 1 </b> is used to <b>1)</b> measure <b>C01</b> intensity inside objects identified in <b>C00</b> and <b>2)</b> Count the number of seeds (non null pixels) in <b>Object Mask 2</b> inside objects identified in <b>C00</b>. Using objects masks as intensity channel can also be used for object based co-localization study,  or to extract relative object distance distributions (e.g. spots to filaments). Object measurements are performed by <b>IRMA</b> from the object masks returned by <b>JENI</b>, and they are exported to <b>.csv</b> reports. Several intensity channels can be processed at once.
								  </p>
                                  
								  </p>
								  <p><b>JOSE/IRMA: Exporting object models</b></p>
								  <p>
                                  Identified objects can be exported as 3D models so as to be edited/explored externally. Seed masks can be exported as <b>CellInsight</b> files (<b>.xls</b>), an ImageJ macro that can be found in <b>/Tools</b> folder: seeds can be edited and manually classified from this software. Filaments networks can be exported as <a href="http://www.neuronland.org/NLMorphologyConverter/MorphologyFormats/SWC/Spec.html" target="_blank">SWC models</a> or <a href="https://en.wikipedia.org/wiki/Wavefront_.obj_file" target="_blank">Wavefront OBJ models</a>. Plain objects can be exported as <a href="meshhttps://en.wikipedia.org/wiki/STL_(file_format)" target="_blank">STL meshes</a>. 2D object tracks can be exported as <b>SWC</b> trees (the Z dimension encodes time).
                                </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->

                        <div class="content-inner">
                            <section id="identify-section" class="doc-section">
                                <h2 class="section-title">Identifying Objects</h2>
                                <div class="section-block">
                                	<p>
                                	Object identification workflows are configured inside <a href="#journals-section">journals</a>, human readable text files configuring input/output folders, the sequence of <b>LOBSTER</b> functions to apply to each input image and their associated parameters. Journals are processed by typing <b>JENI</b> in the console and selecting a journal from the file browser: </p>
                                  	<ul style="list-style: none;">
                                  	<li>>> <b>JENI</b>;</li>
									</ul>
									</p>
									<p>
									For instance, select the journal <font color="magenta">'Tissue_SegWaterTiles.jl'</font> from <b>/Journals/jl</b>. This journal identifies cells from 2D images from a cell junction label. Every input image is displayed together with the results. Simply press <b>'X'</b> to proceed to the next image. You can also tweak the parameters of a journal and relaunch it from MATLAB console: this is illustrated in <a href="https://drive.google.com/file/d/1N9KWKvS52NMGZH0WiYF8bwJLZsvLFx6J/view?usp=sharing" target="_blank">this video</a>. There are 3 kinds of journals: 2D images (<b>.jl</b>), 3D images (<b>.jls</b>) and 2D/3D time-lapses (<b>.jm</b>).
									</p>
                            </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->

                        <div class="content-inner">
                            <section id="gui-section" class="doc-section">
                                <h2 class="section-title">LOBSTER Panel</h2>
                                <div class="section-block">
                                	<p>To start <b>LOBSTER</b> Panel, type >> <b>LOBSTER</b> in the console. The panel enables to load up to 2 journals, trigger object measurements and export 3D object models. A context help is provided when hovering an item from the panel with the mouse; for now the important items from the upper section are (from left to right):</p>
                                  <ul>
                                  <li>Input images dimensionality (2D/3D)</li>
                                  <li>Whether object models should be exported or not (3D images only)</li>
                                  <li>Input images <b>ZRatio</b> (ratio between slice spacing and pixel size, default to 1)</li>
                                  </ul>
                                  
								  <p>The buttons on the right side are used to save/load a project and to exit the panel. To load a journal, press the button <b>Journal1</b> and browse to its file. Let's open the 2D journal <font color="magenta">'Tissue_SegWaterTiles.jl'</font> again. Loading a journal reads the input and output folders configured in its file and display them in the fields <b>I</b> and <b>O</b> above and below the journal name. These fields can be manually edited if required.</p>

								  <div class="screenshot-holder">
								    	<img class="img-gui" src="assets/images/GUI.png" alt="screenshot" width="480">
				    			  </div>

                                  <p>To launch a journal press on the associated <b>Run</b> button. By default the journal is processed but nothing is shown. To  visually check the input/output of the journal, toggle the button <b>Batch</b> located in the lower part of the Panel to <b>Adjust</b>. If the results are not satisfactory, you can interrupt the journal by pressing <b>'Q'</b>, edit the parameters in the journal by clicking the associated <b>Edit</b> button, save the file (floppy disk or <b>Ctrl+S</b>), and launch the journal again. Once the parameters are well adjusted, toggle back to batch mode and launch the journal to process all images from the input folder. You can open a journal input and output folders by pressing <b>Show In</b> and <b>Show Out</b>.

                                  <p>To perform plain objects (here cells) measurements on the objects identified by <b>Journal1</b>, set the upper drop-down selector (object mask folder) to <b>O1</b> and the lower drop-down selector to '<b>Objs</b>'. Now <b>Run Measure 1</b>: a folder with two <b>.csv</b> files matching the names of the two input images should pop up. You can open these files in an external software, browse the first reports by clicking <b>Show some Reports</b> or inspect measurements summary from MATLAB console.</p>

                                  <div class="screenshot-holder">
								    	<img class="img-gui2" src="assets/images/GUI2.png" alt="screenshot" width="480">
				    			  </div>

				    			  <p>Now load the project <font color="magenta">'FISH.mat'</font>. This project holds two journals: one identifies nuclei and another one identifies FISH markers. Since both journal points to the same input folder, the channel selection is performed from the so called <b>image filter</b> identified by @i in the journals (Edit them to check it). Later on you can refer to <a href="journals.html" target="_blank">this page</a> to get more information about journals, but it is not strictly necessary at this point.</p>
								  
								  <p>As can be observed, <b>Measure 1</b> is linked to <b>O1</b> (measure nuclei). The drop-down selector right below <b>O1</b> is set to <b>O2</b>. This selector is the intensity measurement channel. Since <b>O2</b> is the output of <b>Journal2</b> (FISH seed mask), the number of FISH marker per nucleus can be deduced from object intensity measurements (namely the number of non null pixels). Journals and measurements can be triggered individually manually, or all at once automatically by pressing <b>Run All</b>. When <b>Run All</b> is triggered, the equivalent job script (sequence of console calls) is logged to the console after processing. It is possible to copy these lines to a <b>.m</b> file and use it as a job script (e.g. to send to <b>LOBSTER</b> server or further edit it).</p>

				    			  <p>Of course, regular intensity measurements (from <b>I1</b>) can also be performed. In this case, if the images from the intensity channel to measure hold for instance the string <font color="magenta">'_C01'</font> in their file names, the channel filter should be set to <font color="magenta">'*_C01*.tif'</font> instead of the default <font color="magenta">'*.tif'</font>. This is for instance illustrated in the project <font color="magenta">'NucleiIntensityMeas.mat'</font>.</p>
								  </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->
								  
						<section id="sampleprojects-section" class="doc-section">
							<h2 class="section-title">Sample Projects</h2>
                               <div class="section-block">	  
				    			  <p>Several sample projects that can be loaded from <b>LOBSTER</b> Panel are described below. They illustrate how to export 3D models and perform object tracking. All of these projects can be found in <b>/Projects</b> folder.
								  <br />
								  
								  <p><b>Tracing blood vessels from 3D images, exporting to SWC format and visualizing the model</b></p>
                                  <p>Open project <font color="magenta">'BloodVesselsTracing.mat'</font>, click <b>Run All</b> and visualize the output models (SWC filament networks) by loading the <b>.SWC</b> files from <a href="https://janeliascicomp.github.io/SharkViewer/" target="_blank">this webpage</a>.</p>
								  <br />
                                  
								  <p><b>Segmenting nuclei from 3D images, exporting to STL format and visualizing the mesh</b></p>
								  <p>Open project <font color="magenta">'CellPilar3DMesh.mat'</font>, click <b>Run All</b> and visualize the output models (STL mesh) by drag and droping them to <a href="https://www.viewstl.com/" target="_blank">this web page</a>. For larger meshes, it is recommended to use <a href="http://www.meshlab.net/" target="_blank">MeshLab</a>.
								  </p>
								  <br />
								  
								  <p><b>Detecting nuclei from 3D images, exporting the markers to CellInsight and editing them</b></p>
								  <p>Open project <font color="magenta">'LymphGlandCellInsight.mat'</font>, click <b>Run All</b>. Open ImageJ and drag and drop the macro CellInsight (from <b>Tools/CellInsight/CellInsight.ijm</b>). On first usage, you need to copy the file <b>GetString.ijm</b> (from the same folder) to ImageJ <b>macros</b> folder. Drag and drop the input image (the input folder is opened since the <b>.xls</b> CellInsight file is exported inside). Launch <b>CellInsight.ijm</b> and press <b>Import</b> to load the object markers. The object markers can be explored and edited (see <a href="https://drive.google.com/file/d/1Sy_wuPBjSklokqqrgzfDk4QRdLVWU5OU/view?usp=sharing" target="_blank"> CellInsight documentation</a>). Large images can be opened in virtual stack mode (drag and drop image to ImageJ bar >> until <b>Open as Virtual Stack</b> is displayed).
								  </p>
								  <br />
								  
								  <p><b>Detecting nuclei from 3D images, exporting the markers as an ImageJ interactive montage</b></p>
								  Now, drag and drop the report file (<b>.csv</b>) from the previous project to ImageJ and drag and drop + run the macro <b>Tools/Montager.ijm</b>. This will create an interactive montage of all detected objects, clicking an object jump to its position in the original image. The input image can also be opened in virtual stack mode to handle images of unlimited size.
								  </p>
								  <br />
								  
								  <p><b>Segmenting 2D objects from a time-lapse, tracking them and exploring the results in ImageJ</b></p>
								  <p>Open project <font color="magenta">'HeLaTracking.mat'</font>. This project performs tracking of dividing cells from a sequence of 2D images (<b>TL</b> is enabled to specify that <b>Journal2</b> is a time-lapse journal). As can be noticed, <b>I2</b> points to <b>O1</b> since the 2D images are first segmented into object masks by the first journal before being tracked by the second journal. Measuring the output of the second journal brings 3 report files: area, <b>CMx</b> and <b>CMy</b> (object centroids <b>X</b> and <b>Y</b> position in the images). The results can be visualized by running the ImageJ macro <b>Tools/OverlayTrackedObjects.ijm</b> and selecting the input from the first journal as input folder and the output of the second journal as output folder (label mask).
								  </p>
								  <p>
								  You will notice a small error for cell on top left in the first time point. This is because the tracker expects that the segmentation mask of first time point is manually corrected. You can do it before launching <b>Journal2</b> by opening the first frame (click <b>Journal1 Show Out</b>) and use the macro <b>Tools/MergeParticles</b> to assist correction: Install the macro (Plugins >> Macro >> Install...). Then use ImageJ wand tool to select the pairs of particles to be merged and press <b>F1</b>. Save the image after edition and Run <b>Journal2</b> and <b>Measure 2</b> (<b>do not Run All!</b> or output from <b>Journal 1</b> will be overwritten</b>).
								  </p>
								  <br />
								  
								  <p><b>Processing large 3D images</b></p>
								  <p>To process 3D images of unlimited size, it is necessary to configure journals to do so by defining the variable <b>Brick</b>. Open project <font color="magenta">'CellPilar_brcks.mat'</font> for an example. In this project the sample image is not large but the project is configured to process large images. If you edit <b>Journal 1</b> you will notice that the variable <b>Brick</b> is defined and set to 128 and that the variable <b>GaurdBand</b> is defined and set to 64. This instructs <b>JENI</b> and <b>IRMA</b> to process the image by bricks of size 128 x 128 x Number of slices of the original image, with an overlap of 64 pixels between bricks.</p>
								  
                            </div>
                            </section><!--//doc-section-->

                        <div class="content-inner">
                            <section id="guide-section" class="doc-section">
                                <h2 class="section-title">Using LOBSTER for your own Application</h2>
                                <div class="section-block">
                                  <p>
                                  	Designing practical journals and becoming familiar with <b>LOBSTER</b> functions can take some practice. To get started, the best approach is probably to test and adapt existing journals since many sample journals and companion images are provided (see <a href="https://drive.google.com/file/d/1hn9RIoW2sG8nhYN_fLvrPlskLbM0sao7/view?usp=sharing" target="_blank"><b>LOBSTER</b> documentation</a> <b>Appendix - Applications</b> for the complete list). Here is how you can process:
                                  	<ul>
									<li>Look for a journal performing at least part of the analysis you plan</li>
									<li>Run the journal to see the input images and get a feeling about the results</li>
									<li>Make a copy of the journal and modify it to point to your input image folder (for large images, you probably first want to crop out some illustrative regions)</li>
									<li>Make sure that your images have the same bit depth than the images of the journal, if not optionally convert them.</li>
									<li>Run the journal</li>
									<li>You will probably need to tweak the parameters of some of the function used in the journal to obtain satisfying results. For this, open the journal and edit the parameters as was shown in previous sections. To get help on a function and its parameters, right click its name from MATLAB script editor and select <b>Help on Selection</b></li>
									<li>Completing the project might finally require some customization, such as combining multiple journals and performing cross-measurements or exporting object models (such as illustrated in the previous section)</li>
									</ul>				
                                  </p> 
                            </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->
						
						<div class="content-inner">
                            <section id="readon-section" class="doc-section">
                                <h2 class="section-title">Read On</h2>
                                <div class="section-block">
                                  <p>
									 Some more features are available in <b>LOBSTER</b>, refer to the complete <a href="https://drive.google.com/file/d/1hn9RIoW2sG8nhYN_fLvrPlskLbM0sao7/view?usp=sharing" target="_blank"> documentation</a> for more details.
									 Also read on details about <a href="journals.html" target="_blank">journals</a></li> and <a href="scripting.html" target="_blank"> scripting</a> to build projects involving more that two journals or perform advanced operations.
                                  </p> 
                            </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->
                   	</div><!--//doc-content-->

                    <div class="doc-sidebar col-md-3 col-12 order-0 d-none d-md-flex">
                        <div id="doc-nav" class="doc-nav">
	                        <nav id="doc-menu" class="nav doc-menu flex-column sticky">
								<a class="nav-link scrollto" href="#intro-section">Introduction</a>
								<a class="nav-link scrollto" href="#setup-section">Setting Up</a>
								<a class="nav-link scrollto" href="#init-section">Initialiazing</a>
								<a class="nav-link scrollto" href="#architecture-section">Architecture</a>
								<a class="nav-link scrollto" href="#identify-section">Identifying Objects</a>
								<a class="nav-link scrollto" href="#gui-section">LOBSTER Panel</a>
								<a class="nav-link scrollto" href="#sampleprojects-section">Sample Projects</a>
								<a class="nav-link scrollto" href="#guide-section">Customizing a Project</a>
								<a class="nav-link scrollto" href="#readon-section">Read on</a>
	                        </nav>
                        </div><!--//doc-menu-->
                    </div><!--//doc-sidebar-->
                </div><!--//doc-body-->              
            </div><!--//container-->
        </div><!--//doc-wrapper-->
    </div><!--//page-wrapper-->
    
    <footer id="footer" class="footer text-center">
        <div class="container">
            <!--/* This template is released under the Creative Commons Attribution 3.0 License. Please keep the attribution link below when using for your own project. Thank you for your support. :) If you'd like to use the template without the attribution, you can buy the commercial license via our website: themes.3rdwavemedia.com */-->
            <small class="copyright">Designed with <i class="fas fa-heart"></i> by <a href="https://themes.3rdwavemedia.com/" target="_blank">Xiaoying Riley</a> for developers</small>  
        </div><!--//container-->
    </footer><!--//footer-->
    
    <!-- Main Javascript -->          
    <script type="text/javascript" src="assets/plugins/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/plugins/prism/prism.js"></script>    
    <script type="text/javascript" src="assets/plugins/jquery-scrollTo/jquery.scrollTo.min.js"></script>      
    <script type="text/javascript" src="assets/plugins/stickyfill/dist/stickyfill.min.js"></script>                                                         
    <script type="text/javascript" src="assets/js/main.js"></script>
    
</body>
</html>