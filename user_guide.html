<!DOCTYPE html>
<html lang="en">
<head>
    <title>Getting started with LOBSTER</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">    
    <link rel="shortcut icon" href="favicon.ico">  
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <!-- FontAwesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>
    <!-- Global CSS -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">   
    <!-- Plugins CSS -->    
    <link rel="stylesheet" href="assets/plugins/prism/prism.css">
    <link rel="stylesheet" href="assets/plugins/elegant_font/css/style.css">  
    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="assets/css/styles.css"> 
</head> 

<body class="body-pink">
    <div class="page-wrapper">
        <!-- ******Header****** -->
        <header id="header" class="header">
            <div class="container">
                <div class="branding">
                    <h1 class="logo">
                        <a href="index.html">
                            <span aria-hidden="true" class="icon_documents_alt icon"></span>
                            <span class="text-highlight">LOB</span><span class="text-bold">STER</span>
                        </a>
                    </h1>    
                </div>
            </div>
        </header>
		
        <div class="doc-wrapper">
            <div class="container">
                <div id="doc-header" class="doc-header text-center">
                    <h1 class="doc-title"><i class="icon fa fa-book"></i> Getting Started</h1>
                    <div class="meta"><i class="far fa-clock"></i> Last updated: February 24th, 2020</div>
                </div>
				
				<!--//doc-header-->
                <div class="doc-body row">
                    
                    <div class="doc-content col-md-9 col-12 order-1">

						<section id="intro-section" class="doc-section">
						
                    	<p><b>LOBSTER</b> is an image analysis environment to identify biological objects in microscopy images, and measure their spatial location, geometry, dynamics and intensity distribution. The objects can be exported as 2D/3D models, for instance for their exploration/edition in external software, or for the simulation of the processes under study. Multiple images can be processed in one go and image size is not limited by the main memory of the workstation.</p>

						</section>

                        <div class="content-inner">
                            <section id="setup-section" class="doc-section">
                                <h2 class="section-title">Setting Up</h2>
                                <div class="section-block">

                                  <p>Assuming that <b>MATLAB</b> (version >=2015a), <b>Image processing</b> and <b>Statistics & Machine Learning</b> toolboxes are installed:</p>
								  <ul>
                                   <li>Download the <a href="https://github.com/SebastienTs/LOBSTER" target="_blank"> source code</a> (green button)</li>
                                   <li>Unzip the content to an empty folder where <b>MATLAB</b> has write access</li> 
                                   <li>Create an empty folder <b>/Images</b> inside the installation folder and unzip <a href="https://drive.google.com/file/d/18A0sm-69TTEl-19DAprqiLHmO-0nBkg4/view?usp=sharing" target="_blank">this archive</a> (sample images)</li>
                                   <li>Create an empty folder <b>/Results</b> inside the installation folder and unzip <a href="https://drive.google.com/file/d/1GiJd-JfBvOHJcm_WOB1_gAvMuRAZzOy3/view?usp=sharing" target="_blank">this archive</a> (sample results).</li>
                                   </ul>
                                   Microsoft Windows (7/8/10) is recommended, but most <b>LOBSTER</b> features are supported by the major operating systems. Refer to <a href="https://drive.google.com/file/d/1hn9RIoW2sG8nhYN_fLvrPlskLbM0sao7/view?usp=sharing" target="_blank"> documentation</a> for details (<b>Requirements, Installation and Startup</b>).

                                  </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->

                        <div class="content-inner">
                            <section id="init-section" class="doc-section">
                                <h2 class="section-title">Initializing</h2>
                                <div class="section-block">
                                   <p>Launch <b>MATLAB</b> and type the following lines from the console:</p>
                                   <p style="margin-left:2em;">>> <b>cd E:/LOBSTER</b> (update path to installation folder)</p>
                                   <p style="margin-left:2em;">>> <b>init</b></p>
                                   The procedure is illustrated in this <a href="https://drive.google.com/file/d/1N9KWKvS52NMGZH0WiYF8bwJLZsvLFx6J/view?usp=sharing" target="_blank">video</a>.  

                                  </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->

                        <div class="content-inner">
						
                            <section id="gui-section" class="doc-section">
                                <h2 class="section-title">LOBSTER Panel</h2>
                                <div class="section-block">
                                	<p>To start the Panel, type >> <b>LOBSTER</b>.</p>
									<p>From this interface, you can load up to 2 object identification workflows (journals), trigger object measurements and export object models. To load a journal, click <b>Journal1</b> and select it from the file browser.</p>
									
									<div class="screenshot-holder">
								    	<img class="img-gui2" src="assets/images/GUI2.png" alt="screenshot" width="480">
									</div>

								   <p> For instance, load the 2D journal <font color="magenta">'Tissue_SegWaterTiles.jl'</font>. The input and output folders configured in the journal are automatically parsed and displayed in the fields <b>I</b> and <b>O</b>. These fields can also be manually edited or set from a file browser by clicking the corresponding buttons. This is convenient to use existing journals to process new image folders.</p>

                                  <p>To launch the journal, click <b>Run Journal 1</b>. By default the journal is processed but nothing is shown (batch mode), this behaviour can be changed from the button <b>Batch</b> located at the bottom. Every input image is displayed together with the results, press <b>'m'</b> to toggle the results, and <b>'x'</b> to proceed to the next image. If many images are present in the input folder and you want to skip them, press <b>'q'</b>.</p>
								  
								  <p>If the results are not satisfactory, you can tweak the parameters of the functions called by the journal (<b>Edit</b>), save the journal (floppy disk) and launch it again. From the journal editor, press <b>F1</b> while hovering over a function (<b>@</b>) to get help on its parameters.  Once the results are satisfactory, toggle to batch mode and launch the journal to process all images from the input folder.</p>
								  
								  <p>The input and output folders of a journal can be browsed by clicking <b>Show In</b> and <b>Show Out</b>. To perform measurements on the objects identified by <b>Journal1</b>, set the upper drop-down selector (object mask folder) to <b>O1</b> (that is, the output of <b>Journal 1</b>) and set the lower drop-down selector to '<b>Objs</b>' (plain objects measurements). Press <b>Run Measure 1</b>. Upon completion, press <b>Show Reports</b> to browse the folder holding the <b>CSV</b> reports.</p>
								  
								  <p>Finally, journal calls and measurements can be all triggered sequentially by pressing <b>Run All</b>. Refer to the context help provided when hovering over the other items.</p>

								  </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->
								  
						<section id="sampleprojects-section" class="doc-section">
							<h2 class="section-title">Sample Projects</h2>
                               <div class="section-block">
							   
							      <p>Several sample projects are described in this section, the corresponding files (<b>.mat</b>) can be found in <b>LOBSTER /Projects</b> folder. It is possible to open an existing project by clicking <b>Load</b>.</p>
								  
								  <p><b>Tracing blood vessels from 3D images</b></p>
								  <p>Tracing blood vessels from 3D images, exporting to SWC format and visualizing the 3D models.</p>
                                  <p>Load project <font color="magenta">'BloodVesselsTracing.mat'</font>, click <b>Run All</b> and visualize resulting <b>.SWC</b> files by loading them from <a href="https://janeliascicomp.github.io/SharkViewer/" target="_blank">this webpage</a>.</p>
								  <br />
                                  
								  <p><b>Segmenting nuclei from 3D images</b></p>
								  <p>Segmenting nuclei from 3D images, exporting to STL format and visualizing the meshes.</p>
								  <p>Load project <font color="magenta">'CellPilar3DMesh.mat'</font>, click <b>Run All</b> and visualize the STL meshes by drag and dropping them to <a href="https://www.viewstl.com/" target="_blank">this web page</a>. For larger meshes, it is recommended to use <a href="http://www.meshlab.net/" target="_blank">MeshLab</a>.
								  </p>
								  <br />
								  
								  <p><b>Counting FISH spots inside nuclei</b></p>
								  
								  Load the project <font color="magenta">'FISH.mat'</font>. This project holds two journals: the first journal identifies nuclei (DAPI channel) and the the second journal identifies FISH signals (seed mask, one non null pixel per spot). The aim is to count the number of FISH markers inside every nucleus.</p>  
								  
								  The source object mask for <b>Measure 1</b> is set to <b>O1</b> (nuclei mask, output of <b>Journal 1</b>) since we want to measure nuclei, and the drop-down selector right below (intensity measurement channel) is set to <b>O2</b> (<b>Journal2</b> output): this is because we want to count the number of FISH markers per nucleus (number of non null pixels in FISH seed mask). The general principles of how object masks are used to perform measurements is detailed in this <a href="#architecture-section">section</a>.
								  </p> 

								  <p><u>Note</u>: In this particular case, since both journals point to the same input folder, the channel selection (DAPI/FISH) is performed inside the journals. To understand how, you can refer to <a href="journals.html" target="_blank">this page</a>, but this is not strictly necessary at this point.</p>
								  
								  <p><b>Detecting nuclei from 3D images</b></p>
								  <p>Detecting nuclei from 3D images, exporting the markers to <b>LOBSTER CellInsight</b> and editing them.</p>
								  <p>Load project <font color="magenta">'LymphGlandCellInsight.mat'</font>, click <b>Run All</b>. Open ImageJ and drag and drop the macro <b>CellInsight</b> (click <b>TOOLS</b> button to access tools folder).</p>
								  <p><u>Note</u>: The first time you use <b>CellInsight</b>, it is required to copy the file <b>GetString.ijm</b> to ImageJ <b>/macros</b> folder.</p>
								  <p>Drag and drop the input image to ImageJ (click <b>Show In</b> to browse input folder). Launch <b>CellInsight.ijm</b> from ImageJ macro editor, and press <b>Import</b> to load <b>LOBSTER</b> object markers. The object markers can be explored and edited (see <a href="https://drive.google.com/file/d/1Sy_wuPBjSklokqqrgzfDk4QRdLVWU5OU/view?usp=sharing" target="_blank"> CellInsight documentation</a>). Exit <b>CellInsight</b> by clicking <b>Exit</b>, not by closing the image in ImageJ.</p>
								  <p><u>Note</u>: Large images not fitting in main memory can be opened in virtual stack mode (drag and drop the image to ImageJ bar >> until <b>Open as Virtual Stack</b> is displayed).</p>
								  <br />
								  
								  <p><b>Exporting detected nuclei as an ImageJ interactive montage</b></p>
								  Drag and drop the report file (<b>.csv</b>) from the previous project to ImageJ, open the input image and run the macro <b>Tools/Montager.ijm</b>. This builds an interactive montage of all detected objects: clicking an object in the montage jumps to its position in the original image. The input image can also be opened in virtual stack mode to handle large images not fitting in main memory (drag and drop the image to ImageJ bar >> until <b>Open as Virtual Stack</b> is displayed).
								  </p>
								  <br />
								  
								  <p><b>Tracking dividing nuclei from a 2D time-lapse</b></p>
								  <p>Segmenting 2D objects from a time-lapse, tracking the objects, exploring results in ImageJ and plotting in Matlab.</p>
								  <p>Load project <font color="magenta">'HeLaTracking.mat'</font>. This project performs the segmentation and tracking of dividing nuclei from a sequence of 2D images. <b>TL</b> is enabled to specify that <b>Journal2</b> is a time-lapse journal perfroming tracking (.jlm extension).</p>
								  <p>This time, <b>I2</b> points to <b>O1</b> since the images are first segmented into object masks (Journal 1) before being tracked (Journal 2).</p>
								  <p>When running the first journal, an image window pops up at the end of the processing. This is because the tracker (Journal 2) requires the best possible segmentation mask at first time point. To this end, the user needs to correct erroneous object splitting (most common errors) by drawing small rectangles around false cut lines. Beware to maximize the image window (or zoom around), to make sure that all objects are properly merged. Exit mask correction by double clicking on the image.</p>
								  <p>Measuring <b>O2</b> (Object masks) brings 3 report files: objects areas, <b>CMx</b> and <b>CMy</b> (objects centroids). Tracking results can be visualized from ImageJ macro <b>Tools/OverlayTrackedObjects.ijm</b> by selecting <b>O1</b> as input folder and <b>O2</b> as output folder.</p>
								  <p>To plot some of the measurements, type <b>PlotTrksMeasurements</b> in MATLAB and select the .csv file of the measurement you want to plot. Type the ID of the objects you want to plot.</p>
								  <br />
								  
								  <p><b>Tracking nuclei from a 3D time-lapse</b></p>
								  <p>Segmenting 3D objects from a time-lapse, tracking the objects and exploring the tracks in <b>ImageJ Mastodon</b>.</p>
								  <p>Load project <font color="magenta">'Mastodon3D_Test.mat'</font> and click <b>Run All</b>. To visualize the 3D tracks, an amazing tool is <a href="https://github.com/mastodon-sc/mastodon" target="_blank">ImageJ Mastodon</a>, leveraging the awesome <a href="https://imagej.net/BigDataViewer" target="_blank">ImageJ Big Data Viewer</a>. To use <b>Mastodon</b>, it is first required to convert the input image to <b>Big Data Viewer</b> format by opening the image in ImageJ, making sure the dimensions are right from Image>Properties (Z and T can sometimes be swapped), and calling <b>Plugins > BigDataViewer > Export Current Image as XML/HDF5</b>. It is recommended to export the image to the same folder as the input image folder and with the default name (<b>export.xml</b>).</p> 
								  
								  <p><b>LOBSTER</b> tracks can be converted to a format importable by <b>Mastodon</b> by typing <b>MamutExport</b> in Matlab console, and selecting the required files/folders: the XML input file should be in <b>Images/Mastodon3D/export.xml</b> and tracking / report folders are respectively <b>O2</b> and <b>R2</b> for this project.</p>
								  
								  <p>Upon conversion, open Mastodon from ImageJ. Click <b>New project</b> in <b>Mastodon</b> window and select the input image XML file (<b>export.xml</b>). Click <b>import mamut</b> and select <b>export_mamut.xml</b>. Click <b>bdv</b> and <b>trackscheme</b> access to the image and track viewers. It is possible to edit the tracks and perform other operations. Refer to <a href="https://github.com/mastodon-sc/mastodon" target="_blank">Mastodon</a> documentation for reference.</p>
								  
								  <p><u>Note</u>: If you want to try Mastodon with object divisions, export the time-lapse from the previous project as XML/HDF5 and perform the same operations.</p>
								  
								  <p><b>Processing large 3D images</b></p>
								  <p>To process large 3D images, bricking should be enabled by defining the variable <b>Brick</b> in the journal. For example, load the project <font color="magenta">'CellPilar_brcks.mat'</font> and inspect the journal (<b>Edit</b>): the variable <b>Brick</b> is set to 128 and the variable <b>GaurdBand</b> is set to 64. Both <b>JENI</b> and <b>IRMA</b> process the image by bricks of size 128 x 128, with an overlap of 64 pixels between bricks.</p>
								  
								  <p>If needed, it is possible to convert bricked output masks to regular masks (folder of image slices) by typing <b>ExportBricksAsSlices</b> in MATLAB console. Select <b>one of the folders</b> (output image) from the output folder (here <b>O1</b>) and an empty folder to export the slices.

                            </div>
                            </section><!--//doc-section-->

						<div class="content-inner">
                            <section id="architecture-section" class="doc-section">
	                              <h2 class="section-title">Architecture</h2>
	                              <div class="section-block">
	                              <p>
	                              Objects identification, measurements and modeling are performed sequentially and the results are stored in simple formats after each step. These operations are respectively performed by three computational modules called from MATLAB console (scripting) or <b>LOBSTER</b> Panel (Graphical User Interface). In this tutorial we cover the Panel, refer to <a href="scripting.html" target="_blank">this page</a> for scripting.
				    			  </p>
                                  <div class="screenshot-holder">
								    <img class="img-architecture" src="assets/images/architecture.png" alt="screenshot" width="480">
				    			  </div>
                                  <p>
                                  <b>JENI: Identifying objects</b></p>
                                  <p>All TIFF images from an input folder are typically processed into object masks by applying a sequence of image analysis functions (workflow) configured in a journal (short text file). The object masks can be of four kinds illustrated in the figure above:</p>
                                  <ul>
                                  	<li>Binary masks ('<b>Objs</b>'): objects encoded as connected groups of foreground pixels</li>
									<li>Skeleton masks ('<b>Skls</b>'): 1-pixel curves marking filament centrelines</li>
									<li>Seed masks ('<b>Spts</b>'): foreground pixels mark objects</li>
									<li>Label masks ('<b>Trks</b>'): objects encoded as connected groups of pixels with same intensity level (unique <b>ID</b>).</li>
								  </ul>
                                  </p>
								  
                                  <p><b>IRMA: Measuring object masks</b></p>
                                  <p>
								  
								  <div class="screenshot-holder">
								    <img class="img-objmask" src="assets/images/ObjectMask.png" alt="screenshot" width="480">
				    			  </div>
								  
								  <p>
								  Object masks can be used to measure objects or become the basic building blocks of more complex workflows. For instance, in the figure above <b>Object Mask 1 </b> is both used to measure <b>C01</b> intensity and count the number of <b>C02</b> objects inside <b>C00</b> objects. Objects masks can also be used for object based co-localization study,  or to extract relative object distance distributions (e.g. spots to filaments). All object measurements are performed by <b>IRMA</b> from the object masks, and results are exported to <b>.csv</b> reports.
								  </p>
                                  
								  </p>
								  <p><b>JOSE/IRMA: Exporting object models</b></p>
								  <p>
                                  Identified objects can be exported as 2D/3D models so as to be explored externally: filaments networks are exported as <a href="http://www.neuronland.org/NLMorphologyConverter/MorphologyFormats/SWC/Spec.html" target="_blank">SWC</a> or <a href="https://en.wikipedia.org/wiki/Wavefront_.obj_file" target="_blank">OBJ models</a>, object surfaces are exported as <a href="meshhttps://en.wikipedia.org/wiki/STL_(file_format)" target="_blank">STL meshes</a> and object tracks are exported as <b>SWC</b> trees. Finally, object markers can be exported as <b>CellInsight</b> files (<b>.xls</b>), an ImageJ macro (provided in <b>/Tools</b> folder) enabling to edit and visualize them.    
                                </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->
							
                        <div class="content-inner">
                            <section id="guide-section" class="doc-section">
                                <h2 class="section-title">Using LOBSTER for your own Application</h2>
                                <div class="section-block">
                                  <p>
                                  	Designing practical journals and becoming familiar with <b>LOBSTER</b> functions can take some practice. To get started, the best approach is probably to test and adapt existing journals since many sample journals and companion images are provided (see <a href="https://drive.google.com/file/d/1hn9RIoW2sG8nhYN_fLvrPlskLbM0sao7/view?usp=sharing" target="_blank"><b>LOBSTER</b> documentation</a> <b>Appendix - Applications</b> for the complete list). Here is how you can process:
                                  	<ul>
									<li>Look for a journal performing at least part of the analysis you plan</li>
									<li>Run the journal to see the input images and get a feeling about the results</li>
									<li>Make a copy of the journal and modify it to point to your input image folder (for large images, you probably first want to crop out some illustrative regions)</li>
									<li>Make sure that your images have the same bit depth than the images of the journal, if not optionally convert them.</li>
									<li>Run the journal</li>
									<li>You will probably need to tweak the parameters of some of the function used in the journal to obtain satisfying results. For this, open the journal and edit the parameters as was shown in previous sections. To get help on a function and its parameters, right click its name from MATLAB script editor and select <b>Help on Selection</b></li>
									<li>Completing the project might finally require some customization, such as combining multiple journals and performing cross-measurements or exporting object models (such as illustrated in the previous section)</li>
									</ul>				
                                  </p> 
                            </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->
						
						<div class="content-inner">
                            <section id="readon-section" class="doc-section">
                                <h2 class="section-title">Read On</h2>
                                <div class="section-block">
                                  <p>
									 Some more features are available in <b>LOBSTER</b>, refer to the complete <a href="https://drive.google.com/file/d/1hn9RIoW2sG8nhYN_fLvrPlskLbM0sao7/view?usp=sharing" target="_blank"> documentation</a> for more details.
									 Also read on details about <a href="journals.html" target="_blank">journals</a></li> and <a href="scripting.html" target="_blank"> scripting</a> to build projects involving more that two journals or perform advanced operations.
                                  </p> 
                            </div>
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->
                   	</div><!--//doc-content-->

                    <div class="doc-sidebar col-md-3 col-12 order-0 d-none d-md-flex">
                        <div id="doc-nav" class="doc-nav">
	                        <nav id="doc-menu" class="nav doc-menu flex-column sticky">
								<a class="nav-link scrollto" href="#intro-section">Introduction</a>
								<a class="nav-link scrollto" href="#setup-section">Setting Up</a>
								<a class="nav-link scrollto" href="#init-section">Initialiazing</a>
								<a class="nav-link scrollto" href="#gui-section">LOBSTER Panel</a>
								<a class="nav-link scrollto" href="#sampleprojects-section">Sample Projects</a>
								<a class="nav-link scrollto" href="#architecture-section">Architecture</a>
								<a class="nav-link scrollto" href="#guide-section">Customizing a Project</a>
								<a class="nav-link scrollto" href="#readon-section">Read on</a>
	                        </nav>
                        </div><!--//doc-menu-->
                    </div><!--//doc-sidebar-->
                </div><!--//doc-body-->              
            </div><!--//container-->
        </div><!--//doc-wrapper-->
    </div><!--//page-wrapper-->
    
    <footer id="footer" class="footer text-center">
        <div class="container">
            <!--/* This template is released under the Creative Commons Attribution 3.0 License. Please keep the attribution link below when using for your own project. Thank you for your support. :) If you'd like to use the template without the attribution, you can buy the commercial license via our website: themes.3rdwavemedia.com */-->
            <small class="copyright">Designed with <i class="fas fa-heart"></i> by <a href="https://themes.3rdwavemedia.com/" target="_blank">Xiaoying Riley</a> for developers</small>  
        </div><!--//container-->
    </footer><!--//footer-->
    
    <!-- Main Javascript -->          
    <script type="text/javascript" src="assets/plugins/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/plugins/prism/prism.js"></script>    
    <script type="text/javascript" src="assets/plugins/jquery-scrollTo/jquery.scrollTo.min.js"></script>      
    <script type="text/javascript" src="assets/plugins/stickyfill/dist/stickyfill.min.js"></script>                                                         
    <script type="text/javascript" src="assets/js/main.js"></script>
    
</body>
</html>